<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Table with row/col span</title>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <style type="text/css">
        .aaa {
            margin: 0 auto;
            border-collapse: collapse;
            border: 1px solid black;
            font: 12px/12px "Times New Roman" black;
            width: 500px;
        }

            .aaa th {
                border: 1px solid black;
                background-color: #ffd800;
            }

            .aaa td {
                border: 1px solid black;
            }
            #first {
                width: 100%;
                border-collapse: collapse;
                table-layout: fixed;
            }
            #first th {
                border: 1px solid black;
                background-color: #ffd800;
            }
            #first td {
                border: 1px solid black;
            }
    </style>
    <script type="text/javascript">
        function Init(tableId) {
            var t = document.getElementById(tableId);
            var rows = t.rows;
            for (var i = 0; i < rows[0].cells.length; i++) {
                rows[0].cells[i].addEventListener('click', Sort, true);
            }
            function Sort(e) {
                e.preventDefault();
                e.stopPropagation();
                var iterations = 0;
                if (this.className.indexOf('asc') == -1) {
                    this.className = 'asc';
                    var rows = Array.prototype.slice.call(this.offsetParent.rows),
                        col = [],
                        insertInCol = [];
                    rows.shift();
                    for (var i = 0; i < rows.length; i++) {
                        if (rows[i].querySelector('[rowspan]')) {
                            var spancell = rows[i].querySelector('[rowspan]');
                            if (spancell.cellIndex === this.cellIndex) {
                                col.push(spancell);
                            }
                            else {
                                insertInCol[insertInCol.length] = [];
                                insertInCol[insertInCol.length - 1].push(rows[i].cells[this.cellIndex]);
                                for (var s = 1; s < spancell.rowSpan; s++) {
                                    if (spancell.cellIndex < this.cellIndex)
                                        insertInCol[insertInCol.length - 1][s] = rows[i + s].cells[this.cellIndex - 1];
                                    else insertInCol[insertInCol.length - 1][s] = rows[i + s].cells[this.cellIndex];
                                }
                                insertInCol[insertInCol.length - 1].sort(SortAsc());
                                moveRows(insertInCol[insertInCol.length - 1], spancell.parentNode);
                                col.push(insertInCol[insertInCol.length - 1][0]);
                            }
                            i += spancell.rowSpan - 1;
                        }
                        else col.push(rows[i].cells[this.cellIndex]);
                    }
                    col.sort(SortAsc());
                    moveRows(col);
                    console.log(col);
                }
                else {
                    this.className = 'desc';
                    var rows = Array.prototype.slice.call(this.offsetParent.rows),
                        col = [],
                        insertInCol = [];
                    rows.shift();
                    for (var i = 0; i < rows.length; i++) {
                        if (rows[i].querySelector('[rowspan]')) {
                            var spancell = rows[i].querySelector('[rowspan]');
                            if (spancell.cellIndex === this.cellIndex) {
                                col.push(spancell);
                            }
                            else {
                                insertInCol[insertInCol.length] = [];
                                insertInCol[insertInCol.length - 1].push(rows[i].cells[this.cellIndex]);
                                for (var s = 1; s < spancell.rowSpan; s++) {
                                    if (spancell.cellIndex < this.cellIndex)
                                        insertInCol[insertInCol.length - 1][s] = rows[i + s].cells[this.cellIndex - 1];
                                    else insertInCol[insertInCol.length - 1][s] = rows[i + s].cells[this.cellIndex];
                                }
                                insertInCol[insertInCol.length - 1].sort(SortDesc());
                                moveRows(insertInCol[insertInCol.length - 1], spancell.parentNode);
                                col.push(insertInCol[insertInCol.length - 1][0]);
                            }
                            i += spancell.rowSpan - 1;
                        }
                        else col.push(rows[i].cells[this.cellIndex]);
                    }
                    col.sort(SortDesc());
                    moveRows(col);
                    console.log(col);
                }
                function SortAsc() {
                    return function (a, b) {
                        if (isNumber(a.textContent) && isNumber(b.textContent)) {
                            var a = Number(a.textContent),
                                b = Number(b.textContent);
                            return a === b ? 0 : (a < b ? -1 : 1);
                        }
                        else return a.textContent.localeCompare(b.textContent);
                    }
                }
                function SortDesc() {
                    return function (a, b) {
                        if (isNumber(a.textContent) && isNumber(b.textContent)) {
                            var a = Number(a.textContent),
                                b = Number(b.textContent);
                            return a === b ? 0 : (b < a ? -1 : 1);
                        }
                        else return -a.textContent.localeCompare(b.textContent);
                    }
                }
                function isNumber(value) {
                    if (!isNaN(parseFloat(value)) && isFinite(value))
                        return true;
                    else return false;
                }
                function moveRows(tdsArr, spanrow) {
                    var currentRow = 1,
                        moveAgain = false,
                        elem = tdsArr[0].offsetParent;
                    if (spanrow) {
                        var spanRowIndex = spanrow.rowIndex;
                        for (var i = 0; i < tdsArr.length; i++) {
                            var index = tdsArr[i].parentNode.rowIndex,
                                spancell = spanrow.querySelector('[rowspan]');
                            if (index !== spanRowIndex + i) {
                                if (index > spanRowIndex + i)
                                    spanrow.parentNode.insertBefore(tdsArr[i].parentNode, elem.rows[spanRowIndex + i]);
                                else spanrow.parentNode.insertBefore(tdsArr[i].parentNode, elem.rows[spanRowIndex + i + 1]);
                            }
                        }
                        tdsArr[0].parentNode.insertBefore(spanrow.querySelector('[rowspan]'), tdsArr[0].parentNode.cells[0]);
                    }
                    else {
                        for (var i = 0; i < tdsArr.length; i++) {
                            var index = tdsArr[i].parentNode.rowIndex,
                                spancell = tdsArr[i].parentNode.querySelector('[rowspan]');
                                if (index !== currentRow) {
                                    if (currentRow > index) {
                                        if (spancell) {
                                            for (var j = 0; j < spancell.rowSpan; j++) {
                                                elem.rows[i + 1].parentNode.insertBefore(elem.rows[index], elem.rows[currentRow + 1]);
                                            }
                                            currentRow += spancell.rowSpan;
                                        }
                                        else {
                                            elem.rows[i + 1].parentNode.insertBefore(elem.rows[index], elem.rows[currentRow + 1]);
                                            currentRow++;
                                        }
                                        moveAgain = true;
                                    }
                                    else {
                                        if (spancell) {
                                            for (var j = 0; j < spancell.rowSpan; j++) {
                                                elem.rows[i + 1].parentNode.insertBefore(elem.rows[index + spancell.rowSpan - 1], elem.rows[currentRow]);
                                            }
                                            currentRow += spancell.rowSpan;
                                        }
                                        else {
                                            elem.rows[i + 1].parentNode.insertBefore(elem.rows[index], elem.rows[currentRow]);
                                            currentRow++;
                                        }
                                        moveAgain = true;
                                    }
                                }
                                else {
                                    if (spancell && index === currentRow) {
                                        currentRow += spancell.rowSpan;
                                    }
                                    else {
                                        if (!spancell && index === currentRow) {
                                            currentRow++;
                                        }
                                    }
                                }
                            }
                    }
                    iterations++;
                    console.log(iterations + ' ' + moveAgain);
                    if (moveAgain)
                        moveRows(tdsArr, spanrow);
                }
            }
        }
    </script>
</head>
<body>
    <div id="wrapper">
        <table class="aaa" id="aa">
            <thead>
                <tr>
                    <th><a href="#">Date</a></th>
                    <th><a href="#">Quant.</a></th>
                    <th><a href="#">Text</a></th>
                    <th><a href="#">Last</a></th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>2014-01-02</td>
                    <td>25</td>
                    <td>Test 1</td>
                    <td></td>
                </tr>
                <tr>
                    <td rowspan="2">2014-02-02</td>
                    <td>30</td>
                    <td>Text 2</td>
                    <td></td>
                </tr>
                <tr>
                    <td>15</td>
                    <td>Text 3</td>
                    <td></td>
                </tr>
                <tr>
                    <td>2014-06-02</td>
                    <td>45</td>
                    <td>Text 4</td>
                    <td></td>
                </tr>
                <tr>
                    <td>2014-01-05</td>
                    <td>10</td>
                    <td>Text 5</td>
                    <td></td>
                </tr>
                <tr>
                    <td>2014-04-02</td>
                    <td>75</td>
                    <td>Text 6</td>
                    <td></td>
                </tr>
                <tr>
                    <td>2014-05-02</td>
                    <td>75</td>
                    <td>Text 7</td>
                    <td></td>
                </tr>
                <tr>
                    <td>2014-10-02</td>
                    <td>80</td>
                    <td>Text 8</td>
                    <td></td>
                </tr>
                <tr>
                    <td rowspan="5">2014-10-12</td>
                    <td>90</td>
                    <td>Text 9</td>
                    <td>1</td>
                </tr>
                <tr>
                    <!--<td>2013-04-02</td>-->
                    <td>250</td>
                    <td>Text 10</td>
                    <td>2</td>
                </tr>
                <tr>
                    <td rowspan="3">115</td>
                    <td>Text 11</td>
                    <td>3</td>
                </tr>
                <tr>
                    <td rowspan="2">Text 12</td>
                    <td>4</td>
                </tr>
                <tr>
                    <!--<td>20</td>-->
                    <!--<td>Text 13</td>-->
                    <td>5</td>
                </tr>
                <tr>
                    <td>2014-12-12</td>
                    <td>115</td>
                    <td>Text 14</td>
                    <td></td>
                </tr>
            </tbody>
        </table>
        <br/>
        <table class="table1" id="first">
            <thead>
                <tr>
                    <th>A</th>
                    <th>B</th>
                    <th>C</th>
                    <th>D</th>
                    <th>E</th>
                    <th>F</th>
                    <th>G</th>
                    <th>H</th>
                    <th>I</th>
                    <th>J</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>A1</td>
                    <td>B1</td>
                    <td>C1</td>
                    <td>1</td>
                    <td>Ea</td>
                    <td>F1</td>
                    <td>g</td>
                    <td>h</td>
                    <td>I1</td>
                    <td>J1</td>
                </tr>
                <tr>
                    <td>A2</td>
                    <td>B2</td>
                    <td>C2</td>
                    <td>2</td>
                    <td>Eb</td>
                    <td>F2</td>
                    <td>gg</td>
                    <td>h0</td>
                    <td>I2</td>
                    <td>J1</td>
                </tr>
                <tr>
                    <td>A3</td>
                    <td>B3</td>
                    <td>C3</td>
                    <td>3</td>
                    <td>Ec</td>
                    <td>F3</td>
                    <td>ggg</td>
                    <td>h+h</td>
                    <td>I3</td>
                    <td>J1</td>
                </tr>
                <tr>
                    <td>A4</td>
                    <td>B4</td>
                    <td>C4</td>
                    <td>4</td>
                    <td>Ed</td>
                    <td>F4</td>
                    <td>gggg</td>
                    <td>h+h+h</td>
                    <td>I4</td>
                    <td>J1</td>
                </tr>
                <tr>
                    <td>A5</td>
                    <td>B5</td>
                    <td>C5</td>
                    <td>5</td>
                    <td>Ee</td>
                    <td>F5</td>
                    <td>ggggg</td>
                    <td>h5</td>
                    <td>I5</td>
                    <td>J1</td>
                </tr>
                <tr>
                    <td>A6</td>
                    <td>B6</td>
                    <td>C6</td>
                    <td>6</td>
                    <td>Ef</td>
                    <td>F6</td>
                    <td>gggggg</td>
                    <td>h6</td>
                    <td>I6</td>
                    <td>J1</td>
                </tr>
                <tr>
                    <td>A7</td>
                    <td>B7</td>
                    <td>C7</td>
                    <td>7</td>
                    <td>Eg</td>
                    <td>F7</td>
                    <td>ggggggg</td>
                    <td>h7</td>
                    <td>I7</td>
                    <td>J1</td>
                </tr>
                <tr>
                    <td>A8</td>
                    <td>B8</td>
                    <td>C8</td>
                    <td>8</td>
                    <td>Eh</td>
                    <td>F8</td>
                    <td>gggggggg</td>
                    <td>h8</td>
                    <td>I8</td>
                    <td>J1</td>
                </tr>
                <tr>
                    <td>A9</td>
                    <td>B9</td>
                    <td>C9</td>
                    <td>9</td>
                    <td>Ei</td>
                    <td>F9</td>
                    <td>ggggggggg</td>
                    <td>h9</td>
                    <td>I9</td>
                    <td>J1</td>
                </tr>
                <tr>
                    <td>A10</td>
                    <td>B10</td>
                    <td>C10</td>
                    <td>10</td>
                    <td>Ej</td>
                    <td>F10</td>
                    <td>gggggggggg</td>
                    <td>h*</td>
                    <td>I10</td>
                    <td>J1</td>
                </tr>
            </tbody>
        </table>
    </div>
</body>
</html>